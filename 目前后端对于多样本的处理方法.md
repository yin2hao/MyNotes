
## 原本

**整体流程：**

| 操作         | 前端处理                     | 后端处理                                                                       | 后端返回值                                     |     |
| ---------- | ------------------------ | -------------------------------------------------------------------------- | ----------------------------------------- | --- |
| 仪表创建       | 发送`instrument/add`       | 为数据库`t_gas_instrument`插入一条数据                                               | 不重要                                       |     |
| 创建委托       | 发送`commission/commit`    | 为数据库`t_gas_commission`插入一条数据                                               | 不重要                                       |     |
| 委托受理       | 发送`commission/audit`     | 更新数据库`t_gas_commission`的数据（为对应条目增加检定项目要求，受理人等）</br>为数据库t_gas_task插入一条数据    | 不重要                                       |     |
| 测试任务（分页查询） | 发送`task/queryPage`       | 根据传入数据查询对应的`t_gas_task`表单项并分页返回前端                                          | 抛开响应信息（比如请求是否成功什么的）不说，主体信息（即查询的信息）是一个一维数组 |     |
| 开始实验       | 根据选中的以taskId为基准开始实验      | \                                                                          | \                                         |     |
| 实验存档       | 发送`[当前检定项目]/add`         | 为 `t_gas_[当前检定项目]`插入一条数据                                                   | 不重要                                       |     |
| 核验（分页查询）   | 发送`gasdata/queryPage`    | 根据传入数据查询对应的`t_gas_data`表单项并分页返回前端                                          | 抛开响应信息（比如请求是否成功什么的）不说，主体信息（即查询的信息）是一个一维数组 |     |
| 核验（点击核验按钮） | 发送`gasdata/verifyData`   | 收集该task的所有数据传回前端以供展示                                                       | 不重要                                       |     |
| 核验（确定）     | 发送`gasData/auditConfirm` | 更新task，commission</br>对当前任务的测定数据的结果进行处理，在`t_gas_data`中存储最终结果(合格与否)，并创建三个证书 | 不重要                                       |     |
| 下载文件(分页查询) | 发送`report/queryPage`     | 根据传入数据查询对应的`t_gas_report`表单项并分页返回前端                                        | 抛开响应信息（比如请求是否成功什么的）不说，主体信息（即查询的信息）是一个一维数组 |     |

## 处理后
**整体流程**
* 部分逻辑仍在修改/讨论
* <span style="background-color: green">绿色部分是前端已修改内容</span>
* <span style="background-color: yellow">黄色部分为需要前端需修改内容</span>
* <span style="background-color:red">红色部分为待定（暂时不确定需不需要修改）内容</span>

| 位置                                                       | 前端处理                                                       | 后端处理                                                                                                                                                                                                                               | 后端返回值                                                                   |
| -------------------------------------------------------- | ---------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| 仪表创建                                                     | 发送instrument/add                                           | 为数据库t_gas_instrument插入一条数据                                                                                                                                                                                                         | 不重要                                                                     |
| 创建委托                                                     | 发送commission/commit                                        | 为数据库t_gas_commission插入一条数据                                                                                                                                                                                                         | 不重要                                                                     |
| 委托受理                                                     | 发送commission/audit                                         | 更新数据库t_gas_commission的数据（为对应条目增加检定项目要求，受理人等）</br>为数据库t_gas_task插入[样品数量(sample)]条数据，对应同一个委托，用来处理每个样品都需要进行实验的问题</br>**于是现在一个仪表对应多个task**                                                                                             | 不重要                                                                     |
| <span style="background-color: green">测试任务（分页查询）</span>  | 发送task/queryPage                                           | 由于`t_gas_task`生成逻辑的更改，此处的返回如果维持原样会不符合预计效果。因此进行改动。</br>改动详情：**后端将同一个仪表对应的所有task收集为一个List**，根据前端请求的pageSize返回pageSize个List包装为一个集合，再包装为pageResult返回</br>根据传入数据查询对应的t_gas_task表单项并分页返回前端</br>如此，前端可以直接复用批量开始实验的逻辑</br>**此处前端已修改by谭云聪** | 抛开相应信息（比如请求是否成功什么的）不说，主体信息（即查询的信息）是一个二维数组`List<List<GasTaskQueryForm>>` |
| <span style="background-color: green">开始实验</span>        | 根据选中的以taskId为基准开始实验                                        | 此时单个图标有对应样品数量(sampleNum)个task，因此点击单个图标的开始实验对应sampleNum个task同时开始                                                                                                                                                                    | \                                                                       |
| 实验存档                                                     | 发送`[当前检定项目]/add`                                           | 为 `t_gas_[当前检定项目]`插入一条数据                                                                                                                                                                                                           | 不重要                                                                     |
| <span style="background-color: yellow">测试数据（分页查询）</span> | 发送`gasdata/queryPage`                                      | 根据传入数据查询对应的`t_gas_data表单项并分页返回前端`</br>预计的改动项与“测试任务（分页查询）”相似**（目前未修改）**                                                                                                                                                             | 抛开响应信息（比如请求是否成功什么的）不说，主体信息（即查询的数据）是一个二维数组`List<List<GasDataQueryForm>>` |
| <span style="background-color: yellow">核验（点击核验按钮）</span> | 发送`gasdata/verifyData`                                     | 收集该task的所有数据传回前端以供展示                                                                                                                                                                                                               | 不重要                                                                     |
| <span style="background-color: yellow">核验（确定）</span>     | 发送`gasData/auditConfirm`</br>发送的内容有所改变，详情参考[[#关于数据核验部分代码]] | 更新task，commission</br>对当前任务的测定数据的结果进行处理，在`t_gas_data`中存储最终结果(合格与否)，并创建三个证书</br>**具体修改逻辑待定**</br>前端发送值预计会需要修改（如下）                                                                                                                   | 不重要                                                                     |
| 下载文件(分页查询)                                               | 发送`report/queryPage`                                       | 根据传入数据查询对应的`t_gas_report`表单项并分页返回前端                                                                                                                                                                                                | 抛开响应信息（比如请求是否成功什么的）不说，主体信息（即查询的信息）是一个一维数组                               |





### 关于数据核验部分代码
预计修改：
* `/gasData/auditConfirm`传入数据修改（目前待定，后端暂未进行修改）：
	* 原传入`Long dataId`
	*  现传入`List<Long> dataIds`